<?php

class Biblioteca {
    public $id;
    public $estoque = 2;
    public $autor;
    public $numeropg;
    public $valor;

    public function livros() {
        if (!in_array($this->id, [1, 2, 3])) {
            return "ID inválido\n";
        }

        if ($this->estoque > 0) {
            $this->AssociarId($this->id);
            $this->estoque--; // remove 1 do estoque
            return "{$this->autor}, Total de páginas: {$this->numeropg}, Valor: R${$this->valor}, Estoque restante: {$this->estoque}\n";
        } else {
            return "Livro ID: {$this->id}, Valor: R${$this->valor}, Fora de estoque!\n";
        }
    }

    public function verificador() {
        if (!in_array($this->id, [1, 2, 3])) {
            return "Tente novamente\n";
        } else {
            return "ID válido\n";
        }
    }

    public function AssociarId($id) {
        $this->id = $id;
        switch ($id) {
            case 1:
                $this->autor = "Autor: Luiz";
                break;
            case 2:
                $this->autor = "Autor: George";
                break;
            case 3:
                $this->autor = "Autor: Isaac";
                break;
            default:
                $this->autor = "Desconhecido";
        }
    }
}

class PessoaBiblio extends Biblioteca {
    public $nome;
    public $endereco;
    public $email;
    public $telefone;

    public function AlugouLivro() {
        if ($this->estoque > 0) {
            return "{$this->nome} alugou o livro ID: {$this->id}\n";
        } else {
            return "Livro ID: {$this->id}, Fora de estoque!\n";
        }
    }

    public function Registro() {
        echo "{$this->nome} registrado. \n";
        echo "Dados: Email: {$this->email}, Telefone: {$this->telefone}, Endereço: {$this->endereco}\n";
    }
}

// Armazena os livros com controle real de estoque
$livros = [];

function iniciarEstoqueGlobal() {
    global $livros;

    $livros[1] = new Biblioteca();
    $livros[1]->id = 1;
    $livros[1]->estoque = 2;
    $livros[1]->valor = 22.00;
    $livros[1]->numeropg = 10;

    $livros[2] = new Biblioteca();
    $livros[2]->id = 2;
    $livros[2]->estoque = 2;
    $livros[2]->valor = 1.00;
    $livros[2]->numeropg = 432;

    $livros[3] = new Biblioteca();
    $livros[3]->id = 3;
    $livros[3]->estoque = 2;
    $livros[3]->valor = 97.00;
    $livros[3]->numeropg = 7612;
}

function RegistrarPessoa() {
    $pessoa = new PessoaBiblio();
    $pessoa->nome = readline("Digite o nome: \n");
    $pessoa->endereco = readline("Digite o endereço: \n");
    $pessoa->email = readline("Digite o email: \n");
    $pessoa->telefone = readline("Digite o telefone: \n");
    $pessoa->Registro();
}

function RegistrarCompra() {
    global $livros;

    $id = (int)readline("Digite o ID do livro: \n");

    if (!isset($livros[$id])) {
        echo "ID inválido, tente novamente\n";
        return;
    }

    echo $livros[$id]->livros();
    echo $livros[$id]->verificador();
}

iniciarEstoqueGlobal(); // Inicializa os livros

// Menu principal
while (true) {
    $opcao = readline("\nDigite 1 para registrar pessoa, 2 para registrar compra, 3 para sair: \n");
    if ($opcao == 1) {
        RegistrarPessoa();
    } elseif ($opcao == 2) {
        RegistrarCompra();
    } elseif ($opcao == 3) {
        echo "Saindo...\n";
        break;
    } else {
        echo "Opção inválida, tente novamente.\n";
    }
}